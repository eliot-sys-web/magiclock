<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>iPhone Lock Screen</title>
<!-- Viewport pour mobile -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">

<!-- Mode plein √©cran iOS -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Lockscreen">

<!-- Ic√¥ne iOS √©cran d'accueil (180x180 px recommand√©) -->
<link rel="apple-touch-icon" href="/iphone-lock/Lock180.png">

<!-- Manifest PWA pour Android/Chrome -->
<link rel="manifest" href="/iphone-lock/manifest.json">

<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
        user-select: none;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        overflow: hidden;
        background: #000;
        width: 100vw;
        height: 100vh;
        position: fixed;
        top: 0;
        left: 0;
    }

    /* LOCKSCREEN - Screenshot en fond */
    #lockscreen {
        width: 100vw;
        height: 100vh;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        display: flex;
        flex-direction: column;
        position: fixed;
        top: 0;
        left: 0;
        background-color: #000;
    }

    #lockscreen.custom {
        background-image: var(--bg-lock);
    }

    /* Overlay pour les ronds dynamiques - AJUST√â POUR iPHONE 13 */
    #dots-overlay {
        position: absolute;
        top: 24%;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 20px;
        z-index: 10;
    }

    .dot {
        width: 14px;
        height: 14px;
        border-radius: 50%;
        border: 2px solid rgba(255, 255, 255, 0.4);
        background: transparent;
        transition: all 0.15s ease;
        position: relative;
    }

    .dot.filled {
        background: white;
        border-color: white;
    }

    /* Mode ajustement individuel */
    body.adjust-individual .dot {
        cursor: move;
        border: 2px solid orange !important;
        background: rgba(255, 165, 0, 0.3) !important;
        z-index: 100;
    }

    body.adjust-individual .dot.dragging {
        border-color: red !important;
        background: rgba(255, 0, 0, 0.5) !important;
        z-index: 101;
    }

    body.adjust-individual #dots-overlay {
        background: rgba(255, 255, 0, 0.1);
        padding: 10px;
        border: 2px dashed orange;
    }

    /* Zones tactiles invisibles sur le clavier */
    .touch-zone {
        position: absolute;
        border-radius: 50%;
        z-index: 5;
        cursor: pointer;
    }

    /* Pour debug : afficher les zones */
    body.debug .touch-zone {
        background: rgba(255, 0, 0, 0.3);
        border: 2px solid red;
    }

    /* HOMESCREEN */
    #homescreen {
        width: 100vw;
        height: 100vh;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        z-index: 200;
        background-color: #000;
    }

    #homescreen.custom {
        background-image: var(--bg-home);
    }

    #homescreen.show {
        display: flex;
    }

    /* SETUP */
    #setup {
        width: 100vw;
        height: 100vh;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px;
        position: fixed;
        top: 0;
        left: 0;
        z-index: 300;
    }

    #setup h1 {
        color: white;
        font-size: 28px;
        margin-bottom: 30px;
        text-align: center;
    }

    .setup-section {
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 20px;
        margin-bottom: 20px;
        width: 100%;
        max-width: 400px;
    }

    .setup-section h2 {
        color: white;
        font-size: 18px;
        margin-bottom: 15px;
    }

    .setup-section input[type="file"] {
        width: 100%;
        color: white;
        background: rgba(255, 255, 255, 0.2);
        border: 2px dashed rgba(255, 255, 255, 0.5);
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 10px;
        cursor: pointer;
    }

    .setup-section input[type="file"]::file-selector-button {
        background: white;
        color: #667eea;
        border: none;
        padding: 8px 15px;
        border-radius: 5px;
        cursor: pointer;
        font-weight: 600;
        margin-right: 10px;
    }

    .code-inputs {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
    }

    .code-inputs input {
        flex: 1;
        padding: 15px;
        font-size: 24px;
        text-align: center;
        border: 2px solid rgba(255, 255, 255, 0.5);
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border-radius: 10px;
        font-weight: bold;
    }

    .code-inputs input:focus {
        outline: none;
        border-color: white;
        background: rgba(255, 255, 255, 0.3);
    }

    .btn {
        background: white;
        color: #667eea;
        border: none;
        padding: 15px 40px;
        font-size: 18px;
        font-weight: 600;
        border-radius: 25px;
        cursor: pointer;
        margin-top: 20px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        transition: transform 0.2s;
    }

    .btn:active {
        transform: scale(0.95);
    }

    .btn.disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .preview {
        width: 100%;
        max-width: 200px;
        height: 120px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        margin-top: 10px;
        background-size: cover;
        background-position: center;
        border: 2px solid rgba(255, 255, 255, 0.3);
    }

    /* Bouton retour en bas √† droite */
    #backBtn {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 60px;
        height: 60px;
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border-radius: 50%;
        display: none;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        cursor: pointer;
        z-index: 400;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        transition: transform 0.2s;
    }

    #backBtn:active {
        transform: scale(0.9);
    }

    #backBtn.show {
        display: flex;
    }

    /* Bouton param√®tres en haut √† droite */
    #settingsBtn {
        position: fixed;
        top: 30px;
        right: 30px;
        width: 50px;
        height: 50px;
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
        border-radius: 50%;
        display: none;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        cursor: pointer;
        z-index: 400;
        transition: transform 0.2s;
    }

    #settingsBtn:active {
        transform: scale(0.9);
    }

    #settingsBtn.show {
        display: flex;
    }

    /* Menu d√©roulant */
    #menu {
        position: fixed;
        top: 90px;
        right: 30px;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-radius: 15px;
        padding: 10px;
        display: none;
        flex-direction: column;
        gap: 5px;
        z-index: 401;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        min-width: 200px;
    }

    #menu.show {
        display: flex;
    }

    .menu-opt {
        padding: 12px 15px;
        cursor: pointer;
        border-radius: 10px;
        transition: background 0.2s;
        font-size: 16px;
    }

    .menu-opt:hover {
        background: rgba(0, 0, 0, 0.1);
    }

    .menu-opt:active {
        background: rgba(0, 0, 0, 0.2);
    }

    /* Animation shake */
    @keyframes shake {
        0%, 100% {
            transform: translateX(-50%);
        }
        25% {
            transform: translateX(calc(-50% - 10px));
        }
        75% {
            transform: translateX(calc(-50% + 10px));
        }
    }
</style>
</head>
<body>
<!-- SETUP (Configuration initiale) -->
<div id="setup">
    <h1>üì± Configuration iPhone Lock</h1>
    
    <div class="setup-section">
        <h2>üîí Screenshot Lockscreen</h2>
        <input type="file" id="lockInput" accept="image/*">
        <div id="lockPreview" class="preview"></div>
    </div>
    
    <div class="setup-section">
        <h2>üè† Screenshot Homescreen</h2>
        <input type="file" id="homeInput" accept="image/*">
        <div id="homePreview" class="preview"></div>
    </div>
    
    <div class="setup-section">
        <h2>üî¢ Code de d√©verrouillage</h2>
        <div class="code-inputs">
            <input type="tel" maxlength="1" id="c1">
            <input type="tel" maxlength="1" id="c2">
            <input type="tel" maxlength="1" id="c3">
            <input type="tel" maxlength="1" id="c4">
        </div>
    </div>
    
    <button class="btn" id="startBtn" onclick="start()">üöÄ Commencer</button>
</div>

<!-- LOCKSCREEN -->
<div id="lockscreen">
    <!-- Overlay avec les 4 ronds -->
    <div id="dots-overlay">
        <div class="dot" data-index="0"></div>
        <div class="dot" data-index="1"></div>
        <div class="dot" data-index="2"></div>
        <div class="dot" data-index="3"></div>
    </div>
</div>

<!-- HOMESCREEN -->
<div id="homescreen"></div>

<!-- Bouton retour -->
<div id="backBtn" onclick="back()">üîô</div>

<!-- Bouton param√®tres -->
<div id="settingsBtn" onclick="menu()">‚öôÔ∏è</div>

<!-- Menu -->
<div id="menu">
    <div class="menu-opt" onclick="toggleDebug()">üëÅÔ∏è Voir les zones</div>
    <div class="menu-opt" onclick="adjustDots()">‚ö™ Ajuster groupe de ronds</div>
    <div class="menu-opt" onclick="toggleIndividualAdjust()">üéØ Ajuster ronds individuels</div>
    <div class="menu-opt" onclick="change()">üñºÔ∏è Changer screenshots</div>
    <div class="menu-opt" onclick="location.reload()">üîÑ Recommencer</div>
</div>

<script>
    // Variables globales
    const setup = document.getElementById('setup');
    const lock = document.getElementById('lockscreen');
    const home = document.getElementById('homescreen');
    const btn = document.getElementById('backBtn');
    const settingsBtn = document.getElementById('settingsBtn');
    const dotsOverlay = document.getElementById('dots-overlay');
    const dots = document.querySelectorAll('.dot');

    let lockImg = null;
    let homeImg = null;
    let code = [];
    let unlock = false;
    let first = null;
    let inp = "";

    // Gestion des inputs de code
    const codeInputs = [
        document.getElementById('c1'),
        document.getElementById('c2'),
        document.getElementById('c3'),
        document.getElementById('c4')
    ];

    codeInputs.forEach((input, index) => {
        input.addEventListener('input', (e) => {
            if (e.target.value) {
                if (index < 3) codeInputs[index + 1].focus();
            }
        });
        
        input.addEventListener('keydown', (e) => {
            if (e.key === 'Backspace' && !e.target.value && index > 0) {
                codeInputs[index - 1].focus();
            }
        });
    });

    // Preview images
    document.getElementById('lockInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(ev) {
                lockImg = ev.target.result;
                document.getElementById('lockPreview').style.backgroundImage = `url(${lockImg})`;
            };
            reader.readAsDataURL(file);
        }
    });

    document.getElementById('homeInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(ev) {
                homeImg = ev.target.result;
                document.getElementById('homePreview').style.backgroundImage = `url(${homeImg})`;
            };
            reader.readAsDataURL(file);
        }
    });

    // D√©marrage de l'application
    function start() {
        code = codeInputs.map(inp => inp.value).filter(v => v);
        
        if (code.length !== 4 || !lockImg || !homeImg) {
            alert('‚ö†Ô∏è Veuillez remplir tous les champs !');
            return;
        }
        
        lock.style.setProperty('--bg-lock', `url(${lockImg})`);
        lock.classList.add('custom');
        
        home.style.setProperty('--bg-home', `url(${homeImg})`);
        home.classList.add('custom');
        
        setup.style.display = 'none';
        lock.style.display = 'flex';
        
        btn.classList.add('show');
        settingsBtn.classList.add('show');
        
        generateTouchZones();
    }

    // G√©n√©ration des zones tactiles
    function generateTouchZones() {
        const existing = document.querySelectorAll('.touch-zone');
        existing.forEach(z => z.remove());
        
        // Positions AJUST√âES pour iPhone 13 bas√©es sur votre capture
        const keys = [
            {num: '1', top: '38.5%', left: '23.5%'},
            {num: '2', top: '38.5%', left: '50%'},
            {num: '3', top: '38.5%', left: '76.5%'},
            {num: '4', top: '49.5%', left: '23.5%'},
            {num: '5', top: '49.5%', left: '50%'},
            {num: '6', top: '49.5%', left: '76.5%'},
            {num: '7', top: '60.5%', left: '23.5%'},
            {num: '8', top: '60.5%', left: '50%'},
            {num: '9', top: '60.5%', left: '76.5%'},
            {num: '0', top: '71.5%', left: '50%'}
        ];
        
        keys.forEach(k => {
            const zone = document.createElement('div');
            zone.className = 'touch-zone';
            zone.style.top = k.top;
            zone.style.left = k.left;
            zone.style.width = '90px';
            zone.style.height = '90px';
            zone.style.transform = 'translate(-50%, -50%)';
            zone.dataset.value = k.num;
            zone.onclick = () => press(k.num);
            lock.appendChild(zone);
        });
    }

    // Gestion de la saisie du code
    function press(num) {
        if (unlock) return;
        
        if (first === null) {
            first = Date.now();
        }
        
        inp += num;
        const idx = inp.length - 1;
        
        if (idx < 4) {
            dots[idx].classList.add('filled');
        }
        
        if (inp.length === 4) {
            setTimeout(() => {
                if (inp === code.join('')) {
                    unlock = true;
                    openHome();
                } else {
                    shake();
                    reset();
                }
            }, 200);
        }
    }

    // Animation shake en cas d'erreur
    function shake() {
        dotsOverlay.style.animation = 'shake 0.4s';
        setTimeout(() => {
            dotsOverlay.style.animation = '';
        }, 400);
    }

    // R√©initialisation des dots
    function reset() {
        inp = "";
        first = null;
        dots.forEach(d => d.classList.remove('filled'));
    }

    // Ouverture du homescreen
    function openHome() {
        lock.style.display = 'none';
        home.style.display = 'flex';
        setTimeout(() => {
            home.classList.add('show');
        }, 10);
    }

    // Retour au lockscreen
    function back() {
        unlock = false;
        first = null;
        inp = "";
        home.classList.remove('show');
        setTimeout(() => {
            home.style.display = 'none';
            lock.style.display = 'flex';
            reset();
        }, 300);
    }

    // Gestion du menu
    function menu() {
        document.getElementById('menu').classList.toggle('show');
    }

    // Mode debug pour voir les zones tactiles
    function toggleDebug() {
        document.body.classList.toggle('debug');
        document.getElementById('menu').classList.remove('show');
    }

    // Variables pour le mode ajustement
    let adjustMode = false;
    let individualAdjustMode = false;
    let draggedElement = null;

    // Ajustement du groupe de dots
    function adjustDots() {
        if (individualAdjustMode) {
            toggleIndividualAdjust();
        }
        
        adjustMode = !adjustMode;
        if (adjustMode) {
            dotsOverlay.style.background = 'rgba(255, 255, 0, 0.2)';
            dotsOverlay.style.padding = '10px';
            dotsOverlay.style.border = '2px dashed orange';
            dotsOverlay.style.cursor = 'move';
            
            dotsOverlay.onmousedown = startDrag;
            dotsOverlay.ontouchstart = startDrag;
        } else {
            dotsOverlay.style.background = '';
            dotsOverlay.style.padding = '';
            dotsOverlay.style.border = '';
            dotsOverlay.style.cursor = '';
            dotsOverlay.onmousedown = null;
            dotsOverlay.ontouchstart = null;
        }
        document.getElementById('menu').classList.remove('show');
    }

    // D√©but du drag du groupe
    function startDrag(e) {
        if (!adjustMode) return;
        draggedElement = dotsOverlay;
        const isTouch = e.type === 'touchstart';
        const clientX = isTouch ? e.touches[0].clientX : e.clientX;
        const clientY = isTouch ? e.touches[0].clientY : e.clientY;
        
        const rect = dotsOverlay.getBoundingClientRect();
        dotsOverlay._offsetX = clientX - rect.left;
        dotsOverlay._offsetY = clientY - rect.top;
        
        e.preventDefault();
    }

    // Ajustement individuel des dots
    function toggleIndividualAdjust() {
        if (adjustMode) {
            adjustDots();
        }
        
        individualAdjustMode = !individualAdjustMode;
        
        if (individualAdjustMode) {
            document.body.classList.add('adjust-individual');
            
            dots.forEach(dot => {
                dot.onmousedown = startDotDrag;
                dot.ontouchstart = startDotDrag;
            });
        } else {
            document.body.classList.remove('adjust-individual');
            
            dots.forEach(dot => {
                dot.onmousedown = null;
                dot.ontouchstart = null;
            });
        }
        document.getElementById('menu').classList.remove('show');
    }

    // D√©but du drag d'un dot individuel
    function startDotDrag(e) {
        if (!individualAdjustMode) return;
        
        draggedElement = e.target;
        draggedElement.classList.add('dragging');
        
        const isTouch = e.type === 'touchstart';
        const clientX = isTouch ? e.touches[0].clientX : e.clientX;
        const clientY = isTouch ? e.touches[0].clientY : e.clientY;
        
        const rect = draggedElement.getBoundingClientRect();
        draggedElement._offsetX = clientX - rect.left - rect.width / 2;
        draggedElement._offsetY = clientY - rect.top - rect.height / 2;
        
        e.preventDefault();
        e.stopPropagation();
    }

    // Gestion du mouvement pendant le drag
    document.addEventListener('mousemove', doDrag);
    document.addEventListener('touchmove', doDrag);

    function doDrag(e) {
        if (!draggedElement) return;
        
        const isTouch = e.type === 'touchmove';
        const clientX = isTouch ? e.touches[0].clientX : e.clientX;
        const clientY = isTouch ? e.touches[0].clientY : e.clientY;
        
        if (draggedElement === dotsOverlay) {
            const lockRect = lock.getBoundingClientRect();
            const newLeft = ((clientX - lockRect.left - dotsOverlay._offsetX) / lockRect.width) * 100;
            const newTop = ((clientY - lockRect.top - dotsOverlay._offsetY) / lockRect.height) * 100;
            
            dotsOverlay.style.left = newLeft + '%';
            dotsOverlay.style.top = newTop + '%';
            dotsOverlay.style.transform = 'none';
        } else {
            const overlayRect = dotsOverlay.getBoundingClientRect();
            const newLeft = clientX - overlayRect.left - draggedElement._offsetX - draggedElement.offsetWidth / 2;
            const newTop = clientY - overlayRect.top - draggedElement._offsetY - draggedElement.offsetHeight / 2;
            
            draggedElement.style.left = newLeft + 'px';
            draggedElement.style.top = newTop + 'px';
        }
        
        e.preventDefault();
    }

    // Fin du drag
    document.addEventListener('mouseup', endDrag);
    document.addEventListener('touchend', endDrag);

    function endDrag() {
        if (draggedElement && draggedElement !== dotsOverlay) {
            draggedElement.classList.remove('dragging');
        }
        draggedElement = null;
    }

    // Retour √† la configuration
    function change() {
        unlock = false;
        first = null;
        inp = "";
        home.classList.remove('show');
        home.style.display = 'none';
        lock.style.display = 'none';
        setup.style.display = 'flex';
        btn.classList.remove('show');
        settingsBtn.classList.remove('show');
        document.getElementById('menu').classList.remove('show');
    }

    // Fermer le menu en cliquant ailleurs
    document.addEventListener('click', e => {
        if (!e.target.closest('#settingsBtn') && !e.target.closest('#menu')) {
            document.getElementById('menu').classList.remove('show');
        }
    });
</script>
</body>
</html>
