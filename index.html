<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>iPhone Lock Screen</title>

<!-- Viewport pour mobile -->

<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<!-- Mode plein √©cran iOS -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Lockscreen">

<!-- Ic√¥ne iOS √©cran d'accueil (180x180 px recommand√©) -->
<link rel="apple-touch-icon" href="/iphone-lock/Lock180.png">

<!-- Manifest PWA pour Android/Chrome -->
<link rel="manifest" href="/iphone-lock/manifest.json">
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
    user-select: none;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    padding : 0;
    overflow: hidden;
    background: #000;
    width: 100vw;
    height: 100vh;
    margin: 0;
    padding: 0;
    padding-top: env(safe-area-inset-top);
    padding-bottom: env(safe-area-inset-bottom);
    min-height: 100vh;
    box-sizing: border-box;
}

#lockscreen {
    width: 100vw;
    height: 100vh;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    display: flex;
    flex-direction: column;
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
    background-color: #000;
}

#lockscreen.custom {
    background-image: var(--bg-lock);
}

#dots-overlay {
    position: absolute;
    top: 23%;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 19px;
    z-index: 10;
}

.dot {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    border: 2px solid rgba(255,255,255,0);
    background: transparent;
    transition: all 0.15s ease;
}

.dot.filled {
    background: white;
    border-color: white;
}

.touch-zone { 
    position: absolute; 
    border-radius: 50%; 
    z-index: 5; 
    cursor: pointer; 
}

body.debug .touch-zone {
    background: rgba(255,0,0,0.3);
    border: 2px solid red;
}

@keyframes shake {
    0%, 100% { transform: translateX(-50%); }
    25% { transform: translateX(calc(-50% - 10px)); }
    75% { transform: translateX(calc(-50% + 10px)); }
}

#homescreen {
    width: 100vw;
    height: 100vh;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    position: fixed;
    top: 0;
    left: 0;
    display: none;
    background-color: #000;
}

#homescreen.custom {
    background-image: var(--bg-home);
}

#code-display {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0,0,0,0.8);
    color: white;
    padding: 30px;
    border-radius: 20px;
    text-align: center;
    font-size: 18px;
    line-height: 1.6;
    max-width: 80%;
}

#upload-section {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    flex-direction: column;
    gap: 10px;
    z-index: 100;
    background: rgba(0,0,0,0.7);
    padding: 15px;
    border-radius: 15px;
}

.file-input-wrapper {
    position: relative;
    overflow: hidden;
    display: inline-block;
}

.file-input-wrapper input[type=file] {
    position: absolute;
    left: -9999px;
}

.file-input-wrapper label {
    display: block;
    padding: 12px 20px;
    background: #007AFF;
    color: white;
    border-radius: 10px;
    cursor: pointer;
    text-align: center;
    font-size: 14px;
}

button {
    padding: 12px 20px;
    background: #34C759;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-size: 14px;
}

button:active {
    opacity: 0.7;
}
</style>
</head>
<body>

<div id="lockscreen">
    <div id="dots-overlay">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
    </div>
</div>

<div id="homescreen">
    <div id="code-display"></div>
</div>

<div id="upload-section">
    <div class="file-input-wrapper">
        <input type="file" id="lockBgInput" accept="image/*">
        <label for="lockBgInput">üì± √âcran verrouill√©</label>
    </div>
    <div class="file-input-wrapper">
        <input type="file" id="homeBgInput" accept="image/*">
        <label for="homeBgInput">üè† √âcran d'accueil</label>
    </div>
    <button onclick="toggleAdjustMode()">üéØ Ajuster positions</button>
</div>

<script>
// ========== VARIABLES GLOBALES ==========

let inp = "";
let unlock = false;
let lockBg = null, homeBg = null;
let fifthDigitTime = null;
const DELAY_THRESHOLD = 5000;

const lock = document.getElementById('lockscreen');
const home = document.getElementById('homescreen');
const dotsOverlay = document.getElementById('dots-overlay');
const dots = document.querySelectorAll('.dot');
const codeDisplay = document.getElementById('code-display');

let adjustMode = false;
let individualAdjustMode = false;
let draggedElement = null;

// ========== GESTION DES POINTS ==========
function updateDots() {
    dots.forEach((dot, i) => {
        if(i < inp.length) {
            dot.classList.add('filled');
        } else {
            dot.classList.remove('filled');
        }
    });
}

function reset() {
    inp = "";
    fifthDigitTime = null;
    updateDots();
}

// ========== LOGIQUE DE CODE ==========
function handle(d) {
    if(inp.length >= 6) return;
    
    const currentTime = Date.now();
    
    inp += d;
    updateDots();
    if(navigator.vibrate) navigator.vibrate(10);
    
    console.log(`Chiffre ${inp.length}: ${d}`);
    
    if(inp.length === 5) {
        fifthDigitTime = currentTime;
        console.log(`‚úÖ 5√®me chiffre ! En attente...`);
    }
    
    if(inp.length === 6) {
        const delay = fifthDigitTime ? (currentTime - fifthDigitTime) : 0;
        console.log(`‚è±Ô∏è D√©lai: ${(delay/1000).toFixed(1)}s`);
        
        setTimeout(() => {
            if(delay >= DELAY_THRESHOLD) {
                console.log(`üîì D√âVERROUILL√â !`);
                unlockScreen(inp, delay);
            } else {
                console.log(`‚ùå D√©lai insuffisant`);
                dotsOverlay.style.animation = 'shake 0.4s';
                if(navigator.vibrate) navigator.vibrate([50, 50, 50]);
                setTimeout(() => {
                    dotsOverlay.style.animation = '';
                    reset();
                }, 400);
            }
        }, 300);
    }
}

function unlockScreen(code, delay) {
    unlock = true;
    lock.style.display = 'none';
    home.style.display = 'block';
    
    codeDisplay.innerHTML = `
        üîì <strong>D√©verrouill√© !</strong><br><br>
        Code : <strong>${code}</strong><br>
        D√©lai : <strong>${(delay/1000).toFixed(2)}s</strong>
    `;
    
    document.getElementById('upload-section').style.display = 'none';
}

// ========== GESTION DES IMAGES ==========
document.getElementById('lockBgInput').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if(file) {
        const reader = new FileReader();
        reader.onload = function(ev) {
            lockBg = ev.target.result;
            localStorage.setItem('lockBg', lockBg);
            lock.style.setProperty('--bg-lock', `url(${lockBg})`);
            lock.classList.add('custom');
        };
        reader.readAsDataURL(file);
    }
});

document.getElementById('homeBgInput').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if(file) {
        const reader = new FileReader();
        reader.onload = function(ev) {
            homeBg = ev.target.result;
            localStorage.setItem('homeBg', homeBg);
            home.style.setProperty('--bg-home', `url(${homeBg})`);
            home.classList.add('custom');
        };
        reader.readAsDataURL(file);
    }
});

window.addEventListener('load', () => {
    const savedLock = localStorage.getItem('lockBg');
    const savedHome = localStorage.getItem('homeBg');
    
    if(savedLock) {
        lockBg = savedLock;
        lock.style.setProperty('--bg-lock', `url(${savedLock})`);
        lock.classList.add('custom');
    }
    
    if(savedHome) {
        homeBg = savedHome;
        home.style.setProperty('--bg-home', `url(${savedHome})`);
        home.classList.add('custom');
    }
});

// ========== MODE AJUSTEMENT ==========
function toggleAdjustMode() {
    adjustMode = !adjustMode;
    
    if(adjustMode) {
        alert('Mode ajustement activ√© !');
        document.body.classList.add('debug');
    } else {
        document.body.classList.remove('debug');
        alert('Mode ajustement d√©sactiv√©');
    }
}

lock.addEventListener('click', function(e) {
    if(!adjustMode) return;
    
    const rect = lock.getBoundingClientRect();
    const x = ((e.clientX - rect.left) / rect.width) * 100;
    const y = ((e.clientY - rect.top) / rect.height) * 100;
    
    const digit = prompt('Quel chiffre ? (0-9, ou "del")');
    
    if(digit === 'del') {
        const zones = document.querySelectorAll('.touch-zone');
        if(zones.length > 0) {
            zones[zones.length - 1].remove();
        }
        return;
    }
    
    if(digit !== null && digit.match(/^[0-9]$/)) {
        createTouchZone(digit, x, y);
    }
});

function createTouchZone(digit, x, y) {
    const zone = document.createElement('div');
    zone.className = 'touch-zone';
    zone.dataset.digit = digit;
    zone.style.left = x + '%';
    zone.style.top = y + '%';
    zone.style.width = '60px';
    zone.style.height = '60px';
    zone.style.transform = 'translate(-50%, -50%)';
    
    zone.addEventListener('click', function(e) {
        if(!adjustMode) {
            e.stopPropagation();
            handle(this.dataset.digit);
        }
    });
    
    lock.appendChild(zone);
}

</script>
</body>
</html>
