<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>iPhone Lock Screen</title>

<!-- Viewport pour mobile -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">

<!-- Mode plein √©cran iOS -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Lockscreen">

<!-- Ic√¥ne iOS √©cran d'accueil (180x180 px recommand√©) -->
<link rel="apple-touch-icon" href="/iphone-lock/Lock180.png">

<!-- Manifest PWA pour Android/Chrome -->
<link rel="manifest" href="/iphone-lock/manifest.json">

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
    user-select: none;
}

html, body {
    width: 100%;
    height: 100%;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    overflow: hidden;
    background: #000;
}

/* ECRANS PLEIN ECRAN */

#setup,
#lockscreen,
#homescreen {
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100vh;
    background-color: #000;
    background-repeat: no-repeat;
    background-position: top center;
    background-size: 100% 100%;  /* colle exactement au screenshot */
}

@supports (height: 100dvh) {
    #setup,
    #lockscreen,
    #homescreen {
        height: 100dvh;
    }
}

/* SETUP : CHOIX DES CAPTURES */

#setup {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: #fff;
    padding: 20px;
    text-align: center;
    gap: 20px;
}

#setup label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
}

#setup input[type=file] {
    display: block;
    margin: 0 auto 10px auto;
}

#startBtn {
    padding: 10px 20px;
    border-radius: 999px;
    border: none;
    background: #fff;
    color: #000;
    font-weight: 600;
    font-size: 16px;
    opacity: .3;
}

#startBtn.enabled {
    opacity: 1;
}

/* LOCKSCREEN */

#lockscreen {
    display: none;
    z-index: 100;
    background-image: var(--bg-lock);
}

/* Bouton r√©glages */

#settingsBtn {
    position: absolute;
    top: 18px;
    right: 18px;
    z-index: 30;
    background: rgba(0,0,0,0.5);
    color: #fff;
    border-radius: 999px;
    border: none;
    padding: 6px 10px;
    font-size: 16px;
}

/* RANG√âE DE RONDS (code) */

#dots-overlay {
    position: absolute;
    top: 26%;                 /* ajuste l√©g√®rement si besoin 24‚Äì28% */
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 2.1vh;               /* espacement relatif √† la hauteur */
    z-index: 10;
}

.dot {
    width: 1.9vh;
    height: 1.9vh;
    border-radius: 50%;
    border: 0.22vh solid rgba(255,255,255,0.35);
    background: transparent;
    transition: all 0.15s ease;
}

.dot.filled {
    background: white;
    border-color: white;
}

/* ZONES TACTILES INVISIBLES (clavier) */

.touch-zone {
    position: absolute;
    width: 8.2vh;
    height: 8.2vh;
    border-radius: 50%;
    transform: translate(-50%, -50%);
    z-index: 5;
    cursor: pointer;
}

/* Pour debug : afficher les zones */
body.debug .touch-zone {
    background: rgba(255,0,0,0.25);
    border: 2px solid red;
}

/* HOMESCREEN */

#homescreen {
    display: none;
    z-index: 200;
    background-image: var(--bg-home);
}

/* Zone du texte r√©v√©lant le code / c√©l√©brit√© */

#secret {
    position: absolute;
    bottom: 18%;
    left: 8%;
    right: 8%;
    color: #fff;
    font-size: 16px;
    line-height: 1.4;
    text-shadow: 0 0 4px #000;
    background: rgba(0,0,0,0.25);
    padding: 10px 12px;
    border-radius: 12px;
}

/* MENU REGLAGES SIMPLE */

#menu {
    position: absolute;
    top: 52px;
    right: 18px;
    background: rgba(0,0,0,0.85);
    color: #fff;
    border-radius: 12px;
    padding: 8px 0;
    font-size: 14px;
    min-width: 190px;
    z-index: 40;
    display: none;
}

#menu.show {
    display: block;
}

#menu button {
    display: block;
    width: 100%;
    padding: 8px 14px;
    background: none;
    border: none;
    text-align: left;
    color: #fff;
    font-size: 14px;
}

/* Petite animation de mauvais code (optionnel) */

@keyframes shake {
    0%   { transform: translateX(-50%) translateY(0); }
    25%  { transform: translateX(-53%) translateY(0); }
    50%  { transform: translateX(-47%) translateY(0); }
    75%  { transform: translateX(-53%) translateY(0); }
    100% { transform: translateX(-50%) translateY(0); }
}

#dots-overlay.shake {
    animation: shake 0.3s linear;
}
</style>
</head>
<body>

<!-- ECRAN DE CONFIGURATION -->
<div id="setup">
    <div>
        <label for="lockInput">Screenshot √©cran verrouill√© (avec clavier et ronds)</label>
        <input type="file" id="lockInput" accept="image/*">
    </div>
    <div>
        <label for="homeInput">Screenshot √©cran d‚Äôaccueil</label>
        <input type="file" id="homeInput" accept="image/*">
    </div>
    <button id="startBtn" disabled>D√©marrer</button>
    <p style="font-size:13px;opacity:.7;margin-top:10px;">
        Astuce : ouvre cette page depuis l‚Äôic√¥ne ‚ÄúAjout√©e √† l‚Äô√©cran d‚Äôaccueil‚Äù pour avoir le vrai plein √©cran comme sur iOS.
    </p>
</div>

<!-- LOCKSCREEN SIMUL√â -->
<div id="lockscreen">
    <button id="settingsBtn">‚öôÔ∏è</button>

    <!-- Rang√©e de ronds -->
    <div id="dots-overlay">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
    </div>

    <!-- Menu r√©glages -->
    <div id="menu">
        <button data-action="toggle-zones">üëÅÔ∏è Afficher / cacher les zones</button>
        <button data-action="drag-dots">üéØ D√©placer la rang√©e de ronds</button>
        <button data-action="change-screens">üñºÔ∏è Changer les screenshots</button>
        <button data-action="restart">üîÑ Recommencer</button>
    </div>
</div>

<!-- HOMESCREEN SIMUL√â -->
<div id="homescreen">
    <div id="secret"></div>
</div>

<script>
/* -----------------------
   REFERENCES DOM
------------------------ */

const setup = document.getElementById('setup');
const lockscreen = document.getElementById('lockscreen');
const homescreen = document.getElementById('homescreen');

const lockInput = document.getElementById('lockInput');
const homeInput = document.getElementById('homeInput');
const startBtn = document.getElementById('startBtn');

const dotsOverlay = document.getElementById('dots-overlay');
const dots = Array.from(document.querySelectorAll('.dot'));
const secret = document.getElementById('secret');

const settingsBtn = document.getElementById('settingsBtn');
const menu = document.getElementById('menu');

/* -----------------------
   ETAT DU TOUR / CODES
------------------------ */

let inp = "";
let unlock = false;
let firstCode = null;   // premier code pens√©

// Codes pr√©d√©finis -> c√©l√©brit√©s
const CODES = {
    "123456": "Brad Pitt",
    "654321": "Emma Watson",
    "111111": "Leonardo DiCaprio"
    // ajoute ici tous les couples code / c√©l√©brit√© que tu veux
};

/* -----------------------
   CHARGEMENT DES IMAGES
------------------------ */

let lockLoaded = false;
let homeLoaded = false;

function updateStartButton() {
    if (lockLoaded && homeLoaded) {
        startBtn.disabled = false;
        startBtn.classList.add('enabled');
    }
}

lockInput.addEventListener('change', e => {
    const file = e.target.files[0];
    if (!file) return;
    const url = URL.createObjectURL(file);
    document.documentElement.style.setProperty('--bg-lock', `url(${url})`);
    lockLoaded = true;
    updateStartButton();
});

homeInput.addEventListener('change', e => {
    const file = e.target.files[0];
    if (!file) return;
    const url = URL.createObjectURL(file);
    document.documentElement.style.setProperty('--bg-home', `url(${url})`);
    homeLoaded = true;
    updateStartButton();
});

startBtn.addEventListener('click', () => {
    if (!lockLoaded || !homeLoaded) return;
    setup.style.display = 'none';
    lockscreen.style.display = 'block';
});

/* -----------------------
   ZONES TACTILES (CLAVIER)
------------------------ */

function createTouchZones() {
    // Positions approximatives (en %) pour un √©cran ratio iPhone X‚Äì14
    // √† ajuster si besoin
    const positions = [
        { num: "1", x: 22, y: 52 },
        { num: "2", x: 50, y: 52 },
        { num: "3", x: 78, y: 52 },
        { num: "4", x: 22, y: 63 },
        { num: "5", x: 50, y: 63 },
        { num: "6", x: 78, y: 63 },
        { num: "7", x: 22, y: 74 },
        { num: "8", x: 50, y: 74 },
        { num: "9", x: 78, y: 74 },
        { num: "0", x: 50, y: 86 }
    ];

    positions.forEach(pos => {
        const z = document.createElement('div');
        z.className = 'touch-zone';
        z.style.left = pos.x + '%';
        z.style.top = pos.y + '%';
        z.dataset.num = pos.num;

        // On g√®re clic + touchstart
        function onPress(ev) {
            ev.preventDefault();
            ev.stopPropagation();
            handleDigit(pos.num);
        }
        z.addEventListener('click', onPress);
        z.addEventListener('touchstart', onPress, { passive: false });

        lockscreen.appendChild(z);
    });
}

createTouchZones();

/* -----------------------
   GESTION DES RONDS
------------------------ */

function updateDots() {
    const n = inp.length;
    dots.forEach((dot, idx) => {
        if (idx < n) dot.classList.add('filled');
        else dot.classList.remove('filled');
    });
}

function resetDots() {
    inp = "";
    updateDots();
}

/* -----------------------
   LOGIQUE DES CODES
------------------------ */

function handleDigit(num) {
    if (unlock) return;
    if (inp.length >= 6) return;

    // vibration courte si dispo
    if (navigator.vibrate) {
        navigator.vibrate(40);
    }

    inp += num;
    updateDots();

    if (inp.length === 6) {
        // 1) Premi√®re saisie : on m√©morise et on ne d√©verrouille PAS
        if (firstCode === null) {
            firstCode = inp;

            setTimeout(() => {
                resetDots();
            }, 150);

            return;
        }

        // 2) Saisies suivantes : seul un code pr√©d√©fini fonctionne
        const celeb = CODES[inp];

        if (celeb) {
            // Bon code
            unlock = true;
            showHome(celeb, inp);
        } else {
            // Mauvais code : petite animation
            wrongCode();
        }
    }
}

function wrongCode() {
    dotsOverlay.classList.add('shake');
    setTimeout(() => {
        dotsOverlay.classList.remove('shake');
        resetDots();
    }, 320);
}

function showHome(celeb, usedCode) {
    lockscreen.style.display = 'none';
    homescreen.style.display = 'block';

    secret.innerHTML = `
        Premier code pens√© : <strong>${firstCode || '‚Äî'}</strong><br>
        Code qui a d√©verrouill√© : <strong>${usedCode}</strong><br>
        C√©l√©brit√© : <strong>${celeb}</strong>
    `;
}

/* -----------------------
   MENU / REGLAGES
------------------------ */

settingsBtn.addEventListener('click', e => {
    e.stopPropagation();
    menu.classList.toggle('show');
});

// Fermer le menu si on clique ailleurs
document.addEventListener('click', e => {
    if (!e.target.closest('#menu') && !e.target.closest('#settingsBtn')) {
        menu.classList.remove('show');
    }
});

// Actions du menu
let dragDotsMode = false;
let draggedElement = null;
let dragOffsetX = 0;
let dragOffsetY = 0;

menu.addEventListener('click', e => {
    const btn = e.target.closest('button');
    if (!btn) return;

    const action = btn.dataset.action;

    if (action === 'toggle-zones') {
        document.body.classList.toggle('debug');
    }

    if (action === 'drag-dots') {
        dragDotsMode = !dragDotsMode;
        btn.textContent = dragDotsMode
            ? 'üéØ Arr√™ter le d√©placement'
            : 'üéØ D√©placer la rang√©e de ronds';
    }

    if (action === 'change-screens') {
        // Retour √† l'√©cran de setup sans recharger
        unlock = false;
        firstCode = null;
        resetDots();
        homescreen.style.display = 'none';
        lockscreen.style.display = 'none';
        setup.style.display = 'flex';
    }

    if (action === 'restart') {
        location.reload();
    }

    menu.classList.remove('show');
});

/* D√©placement de la rang√©e de ronds (si mode actif) */

function onDragStart(e) {
    if (!dragDotsMode) return;
    if (!e.target.closest('#dots-overlay')) return;

    draggedElement = dotsOverlay;
    const isTouch = e.type === 'touchstart';
    const clientX = isTouch ? e.touches[0].clientX : e.clientX;
    const clientY = isTouch ? e.touches[0].clientY : e.clientY;

    const rect = draggedElement.getBoundingClientRect();
    dragOffsetX = clientX - rect.left;
    dragOffsetY = clientY - rect.top;

    e.preventDefault();
    e.stopPropagation();
}

function onDragMove(e) {
    if (!draggedElement) return;
    const isTouch = e.type === 'touchmove';
    const clientX = isTouch ? e.touches[0].clientX : e.clientX;
    const clientY = isTouch ? e.touches[0].clientY : e.clientY;

    const lockRect = lockscreen.getBoundingClientRect();
    const left = clientX - lockRect.left - dragOffsetX + draggedElement.offsetWidth / 2;
    const top = clientY - lockRect.top - dragOffsetY + draggedElement.offsetHeight / 2;

    const percentLeft = (left / lockRect.width) * 100;
    const percentTop = (top / lockRect.height) * 100;

    draggedElement.style.left = percentLeft + '%';
    draggedElement.style.top = percentTop + '%';
    draggedElement.style.transform = 'translateX(-50%)';

    e.preventDefault();
}

function onDragEnd() {
    draggedElement = null;
}

lockscreen.addEventListener('mousedown', onDragStart);
lockscreen.addEventListener('touchstart', onDragStart, { passive: false });
document.addEventListener('mousemove', onDragMove, { passive: false });
document.addEventListener('touchmove', onDragMove, { passive: false });
document.addEventListener('mouseup', onDragEnd);
document.addEventListener('touchend', onDragEnd);

/* -----------------------
   OPTION : TAPER AU CLAVIER (desktop)
------------------------ */
document.addEventListener('keydown', e => {
    if (e.key >= '0' && e.key <= '9') {
        handleDigit(e.key);
    }
});
</script>
</body>
</html>
