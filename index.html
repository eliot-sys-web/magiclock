<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>iPhone Lock</title>
    <link rel="manifest" href="manifest.json">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            user-select: none;
        }

        body {
            margin: 0;
            padding: 0;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            overflow: hidden;
            background: #000;
            width: 100vw;
            min-height: 100vh;
            box-sizing: border-box;
        }

        #lockscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
            transition: opacity 0.5s;
        }

        #lockscreen.unlocked {
            opacity: 0;
            pointer-events: none;
        }

        #dots-overlay {
            display: flex;
            gap: 20px;
            margin-bottom: 40px;
        }

        .dot {
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            transition: all 0.3s;
        }

        .dot.filled {
            background: #fff;
            border-color: #fff;
            transform: scale(1.2);
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        #dots-overlay.shake {
            animation: shake 0.4s;
        }

        #numpad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            padding: 20px;
            max-width: 350px;
        }

        .num-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #fff;
            font-size: 32px;
            font-weight: 300;
            cursor: pointer;
            transition: all 0.2s;
            -webkit-tap-highlight-color: transparent;
        }

        .num-btn:active {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(0.95);
        }

        #homescreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 48px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s;
        }

        #homescreen.visible {
            opacity: 1;
            pointer-events: all;
        }

        /* Bouton Annuler invisible */
        #cancelBtn {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: transparent;
            border: none;
            color: transparent;
            font-size: 0;
            padding: 0;
            cursor: pointer;
            z-index: 15;
            -webkit-tap-highlight-color: transparent;
            width: 80px;
            height: 44px;
            display: none;
        }

        #cancelBtn:active {
            background: rgba(255, 255, 255, 0.05);
        }

        @media (max-width: 400px) {
            .num-btn {
                width: 70px;
                height: 70px;
                font-size: 28px;
            }
            
            #numpad {
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div id="lockscreen">
        <div id="dots-overlay">
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
        </div>

        <div id="numpad">
            <button class="num-btn" onclick="handle('1')">1</button>
            <button class="num-btn" onclick="handle('2')">2</button>
            <button class="num-btn" onclick="handle('3')">3</button>
            <button class="num-btn" onclick="handle('4')">4</button>
            <button class="num-btn" onclick="handle('5')">5</button>
            <button class="num-btn" onclick="handle('6')">6</button>
            <button class="num-btn" onclick="handle('7')">7</button>
            <button class="num-btn" onclick="handle('8')">8</button>
            <button class="num-btn" onclick="handle('9')">9</button>
            <button class="num-btn" style="opacity:0;pointer-events:none;"></button>
            <button class="num-btn" onclick="handle('0')">0</button>
            <button class="num-btn" onclick="deleteDigit()">âŒ«</button>
        </div>

        <button id="cancelBtn" onclick="cancelInput()"></button>
    </div>

    <div id="homescreen">
        ðŸ”“ DÃ©verrouillÃ©
    </div>

    <script>
        let inp = "";
        let first = null;
        let unlock = false;
        const dots = document.querySelectorAll('.dot');
        const dotsOverlay = document.getElementById('dots-overlay');
        const lockscreen = document.getElementById('lockscreen');
        const homescreen = document.getElementById('homescreen');
        const cancelBtn = document.getElementById('cancelBtn');

        function updateDots() {
            dots.forEach((dot, i) => {
                if (i < inp.length) {
                    dot.classList.add('filled');
                } else {
                    dot.classList.remove('filled');
                }
            });
        }

        function handle(d) {
            if (inp.length >= 6) return;
            
            inp += d;
            updateDots();
            
            // Afficher le bouton annuler
            if (inp.length > 0) {
                cancelBtn.style.display = 'block';
            }
            
            if (navigator.vibrate) navigator.vibrate(10);
            
            if (inp.length === 6) {
                if (first === null) {
                    first = inp;
                    setTimeout(() => {
                        inp = "";
                        updateDots();
                        cancelBtn.style.display = 'none';
                    }, 300);
                } else {
                    if (inp === first) {
                        unlock = true;
                        setTimeout(unlockScreen, 300);
                    } else {
                        dotsOverlay.classList.add('shake');
                        setTimeout(() => {
                            dotsOverlay.classList.remove('shake');
                            reset();
                        }, 400);
                    }
                }
            }
        }

        function deleteDigit() {
            if (inp.length > 0) {
                inp = inp.slice(0, -1);
                updateDots();
                if (navigator.vibrate) navigator.vibrate(10);
                
                if (inp.length === 0) {
                    cancelBtn.style.display = 'none';
                }
            }
        }

        function cancelInput() {
            inp = "";
            updateDots();
            cancelBtn.style.display = 'none';
            if (navigator.vibrate) navigator.vibrate(10);
        }

        function unlockScreen() {
            lockscreen.classList.add('unlocked');
            homescreen.classList.add('visible');
        }

        function reset() {
            inp = "";
            first = null;
            unlock = false;
            updateDots();
            cancelBtn.style.display = 'none';
        }

        function change() {
            unlock = false;
            first = null;
            inp = "";
            updateDots();
            lockscreen.classList.remove('unlocked');
            homescreen.classList.remove('visible');
            cancelBtn.style.display = 'none';
        }

        // Initialisation
        window.addEventListener('load', function() {
            cancelBtn.style.display = 'none';
        });

        // Support iOS
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js');
        }
    </script>
</body>
</html>
    if(inp.length > 0) {
        cancelBtn.classList.remove('hidden');
    }
    
    if(navigator.vibrate) navigator.vibrate(10);
    
    if(inp.length === 6) {
        if(first === null) {
            first = inp;
            setTimeout(() => {
                inp = "";
                updateDots();
                cancelBtn.classList.add('hidden'); // AJOUTEZ CETTE LIGNE
            }, 300);
        } else {
            if(inp === first) {
                unlock = true;
                setTimeout(unlockScreen, 300);
            } else {
                dotsOverlay.classList.add('shake');
                setTimeout(() => {
                    dotsOverlay.classList.remove('shake');
                    reset();
                    cancelBtn.classList.add('hidden'); // AJOUTEZ CETTE LIGNE
                }, 400);
            }
        }
    }
}

function updateDots() {
    dots.forEach((d, i) => {
        if(i < inp.length) d.classList.add('filled');
        else d.classList.remove('filled');
    });
}

function reset() {
    inp = "";
    updateDots();
}

function unlockScreen(celeb) {
    unlock = true;
    document.getElementById('secret').innerHTML = `${celeb}<br>${first}`;
    home.style.display = 'block';
    home.classList.add('show');
    lock.style.display = 'none';
    if(navigator.vibrate) navigator.vibrate([50,100,50]);
}
// Settings
function menu() {
    document.getElementById('menu').classList.toggle('show');
}

function toggleDebug() {
    document.body.classList.toggle('debug');
    document.getElementById('menu').classList.remove('show');
}

let adjustMode = false;
let individualAdjustMode = false;
let draggedElement = null;

function adjustDots() {
    // DÃ©sactiver le mode individuel si actif
    if(individualAdjustMode) {
        toggleIndividualAdjust();
    }
    
    adjustMode = !adjustMode;
    if(adjustMode) {
        dotsOverlay.style.background = 'rgba(255,255,0,0.2)';
        dotsOverlay.style.padding = '10px';
        dotsOverlay.style.border = '2px dashed orange';
        dotsOverlay.style.cursor = 'move';
        
        // Rendre draggable
        dotsOverlay.onmousedown = startDrag;
        dotsOverlay.ontouchstart = startDrag;
    } else {
        dotsOverlay.style.background = '';
        dotsOverlay.style.padding = '';
        dotsOverlay.style.border = '';
        dotsOverlay.style.cursor = '';
        dotsOverlay.onmousedown = null;
        dotsOverlay.ontouchstart = null;
    }
    document.getElementById('menu').classList.remove('show');
}

function startDrag(e) {
    if(!adjustMode) return;
    draggedElement = dotsOverlay;
    const isTouch = e.type === 'touchstart';
    const clientX = isTouch ? e.touches[0].clientX : e.clientX;
    const clientY = isTouch ? e.touches[0].clientY : e.clientY;
    
    const rect = dotsOverlay.getBoundingClientRect();
    dotsOverlay._offsetX = clientX - rect.left;
    dotsOverlay._offsetY = clientY - rect.top;
    
    e.preventDefault();
}

// Nouvelle fonction pour ajuster les cercles individuellement
function toggleIndividualAdjust() {
    // DÃ©sactiver le mode groupe si actif
    if(adjustMode) {
        adjustDots();
    }
    
    individualAdjustMode = !individualAdjustMode;
    document.body.classList.toggle('adjust-individual');
    
    if(individualAdjustMode) {
        // Activer le drag sur chaque dot
        dots.forEach(dot => {
            dot.style.position = 'relative';
            dot.onmousedown = startDotDrag;
            dot.ontouchstart = startDotDrag;
        });
    } else {
        // DÃ©sactiver
        dots.forEach(dot => {
            dot.onmousedown = null;
            dot.ontouchstart = null;
        });
    }
    document.getElementById('menu').classList.remove('show');
}

function startDotDrag(e) {
    if(!individualAdjustMode) return;
    
    draggedElement = e.target;
    draggedElement.classList.add('dragging');
    
    const isTouch = e.type === 'touchstart';
    const clientX = isTouch ? e.touches[0].clientX : e.clientX;
    const clientY = isTouch ? e.touches[0].clientY : e.clientY;
    
    const rect = draggedElement.getBoundingClientRect();
    draggedElement._offsetX = clientX - rect.left - rect.width/2;
    draggedElement._offsetY = clientY - rect.top - rect.height/2;
    
    e.preventDefault();
    e.stopPropagation();
}

document.addEventListener('mousemove', doDrag);
document.addEventListener('touchmove', doDrag);

function doDrag(e) {
    if(!draggedElement) return;
    
    const isTouch = e.type === 'touchmove';
    const clientX = isTouch ? e.touches[0].clientX : e.clientX;
    const clientY = isTouch ? e.touches[0].clientY : e.clientY;
    
    if(draggedElement === dotsOverlay) {
        // DÃ©placer tout le groupe
        const lockRect = lock.getBoundingClientRect();
        const newLeft = ((clientX - lockRect.left - dotsOverlay._offsetX) / lockRect.width) * 100;
        const newTop = ((clientY - lockRect.top - dotsOverlay._offsetY) / lockRect.height) * 100;
        
        dotsOverlay.style.left = newLeft + '%';
        dotsOverlay.style.top = newTop + '%';
        dotsOverlay.style.transform = 'none';
    } else {
        // DÃ©placer un cercle individuel
        const overlayRect = dotsOverlay.getBoundingClientRect();
        const newLeft = clientX - overlayRect.left - draggedElement._offsetX - draggedElement.offsetWidth/2;
        const newTop = clientY - overlayRect.top - draggedElement._offsetY - draggedElement.offsetHeight/2;
        
        draggedElement.style.left = newLeft + 'px';
        draggedElement.style.top = newTop + 'px';
    }
    
    e.preventDefault();
}

document.addEventListener('mouseup', endDrag);
document.addEventListener('touchend', endDrag);

function endDrag() {
    if(draggedElement && draggedElement !== dotsOverlay) {
        draggedElement.classList.remove('dragging');
    }
    draggedElement = null;
}

function change() {
    unlock = false;
    first = null;
    inp = "";
    home.classList.remove('show');
    home.style.display = 'none';
    lock.style.display = 'none';
    setup.style.display = 'flex';
    btn.classList.remove('show');
    document.getElementById('menu').classList.remove('show');
}
function change() {
    unlock = false;
    first = null;
    inp = "";
    // ... reste du code existant ...
}

// AJOUTEZ ICI
function cancelInput() {
    inp = "";
    updateDots();
    if(navigator.vibrate) navigator.vibrate(10);
}

document.addEventListener('click', e => {
    if(!e.target.closest('#settingsBtn') && !e.target.closest('#menu')) {
        document.getElementById('menu').classList.remove('show');
    }
});
// AJOUTEZ Ã€ LA FIN DU SCRIPT
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('cancelBtn').classList.add('hidden');
});


</script>
</body>
</html>
